#!/bin/bash
# Opens a file in an emacsclient to the server "_emacs_".
# If the server doesn't exist, starts the server first.

set -e

server_name="_emacs_"
serverdir="${TMPDIR:-/tmp}/emacs${UID}"

if [[ ! -e "${serverdir}/${server_name}" ]]; then
    # Avoid starting emac in a top-level directory, e.g., $HOME.
    # Otherwise zk-index would take forever.
    cd ~/.emacs.d/
    ems "${server_name}" --daemon
    cd -
fi

emc "${server_name}" "$@"
